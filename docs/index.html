<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Welcome to cottoncandy! &#8212; cottoncandy 0.2.0 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api/index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">
          cottoncandy</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Welcome to cottoncandy!</a><ul>
<li><a class="reference internal" href="#what-is-cottoncandy">What is cottoncandy?</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li><a class="reference internal" href="#storing-numpy-arrays">Storing numpy arrays</a></li>
<li><a class="reference internal" href="#storing-dask-arrays">Storing dask arrays</a></li>
<li><a class="reference internal" href="#command-line-search">Command-line search</a></li>
<li><a class="reference internal" href="#filesystem-like-object-browsing">Filesystem-like object browsing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#learn-more">Learn more:</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="api/index.html" title="Next Chapter: API Reference"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">API Reference &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/index.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
  <li>
    <a href="api/index.html" title="Next Chapter: API Reference"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">API Reference &raquo;</span>
    </a>
  </li>
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="welcome-to-cottoncandy">
<h1>Welcome to cottoncandy!<a class="headerlink" href="#welcome-to-cottoncandy" title="Permalink to this headline">¶</a></h1>
<p><em>sugar for s3</em></p>
<p><a class="reference external" href="https://github.com/gallantlab/cottoncandy">https://github.com/gallantlab/cottoncandy</a></p>
<div class="section" id="what-is-cottoncandy">
<h2>What is cottoncandy?<a class="headerlink" href="#what-is-cottoncandy" title="Permalink to this headline">¶</a></h2>
<p>A python scientific library for storing and accessing numpy array data on S3. This is achieved by reading arrays from memory and downloading arrays directly into memory. This means that you don’t have to download your array to disk, and then load it from disk into your python session.</p>
<p>This library relies heavily on boto3 (<a class="reference external" href="https://github.com/boto/boto3">https://github.com/boto/boto3</a>)</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Clone the repo from GitHub and do the usual python install</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">gallantlab</span><span class="o">/</span><span class="n">cottoncandy</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">cottoncandy</span>
<span class="n">sudo</span> <span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<p>A configuration file will be saved under <code class="docutils literal notranslate"><span class="pre">~/.config/cottoncandy/options.cfg</span></code>. Upon installation cottoncandy will try to find your AWS keys and store them in this file. See the <a class="reference external" href="https://github.com/gallantlab/cottoncandy/blob/main/cottoncandy/defaults.cfg">default file</a> for more configuration options.</p>
<p>Object and bucket permissions are set to <code class="docutils literal notranslate"><span class="pre">authenticated-read</span></code> by default. If you wish to keep all your objects private, modify the configuration file and set <code class="docutils literal notranslate"><span class="pre">default_acl</span> <span class="pre">=</span> <span class="pre">private</span></code>. See <a class="reference external" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html">AWS ACL overview</a> for more information on S3 permissions.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Setup the connection (endpoint, access and secret keys can be specified in the configuration file instead):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">cottoncandy</span> <span class="k">as</span> <span class="nn">cc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cci</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">get_interface</span><span class="p">(</span><span class="s1">&#39;my_bucket&#39;</span><span class="p">,</span>
<span class="go">                           ACCESS_KEY=&#39;FAKEACCESSKEYTEXT&#39;,</span>
<span class="go">                           SECRET_KEY=&#39;FAKESECRETKEYTEXT&#39;,</span>
<span class="go">                           endpoint_url=&#39;https://s3.amazonaws.com&#39;)</span>
</pre></div>
</div>
<div class="section" id="storing-numpy-arrays">
<h3>Storing numpy arrays<a class="headerlink" href="#storing-numpy-arrays" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3_response</span> <span class="o">=</span> <span class="n">cci</span><span class="o">.</span><span class="n">upload_raw_array</span><span class="p">(</span><span class="s1">&#39;myarray&#39;</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr_down</span> <span class="o">=</span> <span class="n">cci</span><span class="o">.</span><span class="n">download_raw_array</span><span class="p">(</span><span class="s1">&#39;myarray&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr_down</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="storing-dask-arrays">
<h3>Storing dask arrays<a class="headerlink" href="#storing-dask-arrays" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3_response</span> <span class="o">=</span> <span class="n">cci</span><span class="o">.</span><span class="n">upload_dask_array</span><span class="p">(</span><span class="s1">&#39;test_dim&#39;</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dask_object</span> <span class="o">=</span> <span class="n">cci</span><span class="o">.</span><span class="n">download_dask_array</span><span class="p">(</span><span class="s1">&#39;test_dim&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dask_object</span>
<span class="go">dask.array&lt;array, shape=(100, 600, 1000), dtype=float64, chunksize=(100, 600, 100)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dask_slice</span> <span class="o">=</span> <span class="n">dask_object</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">200</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dask_slice</span>
<span class="go">dask.array&lt;getitem..., shape=(100, 600, 1000), dtype=float64, chunksize=(100, 600, 100)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">downloaded_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dask_slice</span><span class="p">)</span> <span class="c1"># this downloads the array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">downloaded_data</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(100, 600, 200)</span>
</pre></div>
</div>
</div>
<div class="section" id="command-line-search">
<h3>Command-line search<a class="headerlink" href="#command-line-search" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cci</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/path/to/*/file01*.grp/image_data&#39;</span><span class="p">)</span>
<span class="go">[&#39;/path/to/my/file01a.grp/image_data&#39;,</span>
<span class="go"> &#39;/path/to/my/file01b.grp/image_data&#39;,</span>
<span class="go"> &#39;/path/to/your/file01a.grp/image_data&#39;,</span>
<span class="go"> &#39;/path/to/your/file01b.grp/image_data&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cci</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/path/to/my/file02*.grp/*&#39;</span><span class="p">)</span>
<span class="go">[&#39;/path/to/my/file02a.grp/image_data&#39;,</span>
<span class="go"> &#39;/path/to/my/file02a.grp/text_data&#39;,</span>
<span class="go"> &#39;/path/to/my/file02b.grp/image_data&#39;,</span>
<span class="go"> &#39;/path/to/my/file02b.grp/text_data&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="filesystem-like-object-browsing">
<h3>Filesystem-like object browsing<a class="headerlink" href="#filesystem-like-object-browsing" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">cottoncandy</span> <span class="k">as</span> <span class="nn">cc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">browser</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">get_browser</span><span class="p">(</span><span class="s1">&#39;my_bucket_name&#39;</span><span class="p">,</span>
<span class="go">                             ACCESS_KEY=&#39;FAKEACCESSKEYTEXT&#39;,</span>
<span class="go">                             SECRET_KEY=&#39;FAKESECRETKEYTEXT&#39;,</span>
<span class="go">                             endpoint_url=&#39;https://s3.amazonaws.com&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">browser</span><span class="o">.</span><span class="n">sweet_project</span><span class="o">.</span><span class="n">sub</span><span class="o">&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="go">browser.sweet_project.sub01_awesome_analysis_DOT_grp</span>
<span class="go">browser.sweet_project.sub02_awesome_analysis_DOT_grp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">browser</span><span class="o">.</span><span class="n">sweet_project</span><span class="o">.</span><span class="n">sub01_awesome_analysis_DOT_grp</span>
<span class="go">&lt;cottoncandy-group &lt;bucket:my_bucket_name&gt; (sub01_awesome_analysis.grp: 3 keys)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">browser</span><span class="o">.</span><span class="n">sweet_project</span><span class="o">.</span><span class="n">sub01_awesome_analysis_DOT_grp</span><span class="o">.</span><span class="n">result_model01</span>
<span class="go">&lt;cottoncandy-dataset &lt;bucket:my_bucket_name [1.00MB:shape=(10000)]&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="learn-more">
<h2>Learn more:<a class="headerlink" href="#learn-more" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/cottoncandy.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cottoncandy</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api/cottoncandy.browser.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">browser</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api/cottoncandy.interfaces.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">interfaces</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api/cottoncandy.utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">utils</span></code></a></li>
</ul>
</li>
</ul>
</div>
<dl class="field-list simple">
<dt class="field-odd">Release</dt>
<dd class="field-odd"><p>0.2.0</p>
</dd>
<dt class="field-even">Date</dt>
<dd class="field-even"><p>Mar 30, 2020</p>
</dd>
</dl>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright Anwar O. Nunez-Elizalde.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>